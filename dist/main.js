JOB={Config:{Multiple:!0,DecodeFormats:["Code128","Code93","Code39","EAN-13","2Of5","Inter2Of5","Codabar"],ForceUnique:!0,LocalizationFeedback:!1,SkipOrientation:!1},SupportedFormats:["Code128","Code93","Code39","EAN-13","2Of5","Inter2Of5","Codabar"],ScanCanvas:null,ScanContext:null,SquashCanvas:document.createElement("canvas"),ImageCallback:null,StreamCallback:null,LocalizationCallback:null,Stream:null,DecodeStreamActive:!1,Decoded:[],DecoderWorker:new Worker("<%= asset_path('decoder-worker.js.erb') %>"),OrientationCallback:null,Init:function(){JOB.ScanCanvas=JOB.FixCanvas(document.createElement("canvas")),JOB.ScanCanvas.width=640,JOB.ScanCanvas.height=480,JOB.ScanContext=JOB.ScanCanvas.getContext("2d");var a=document.createElement("script");a.src="<%= asset_path('exif.js.erb') %>",a.type="text/javascript",document.getElementsByTagName("head").item(0).appendChild(a)},SetRotationSkip:function(a){JOB.Config.SkipOrientation=a},SetImageCallback:function(a){JOB.ImageCallback=a},SetStreamCallback:function(a){JOB.StreamCallback=a},SetLocalizationCallback:function(a){JOB.LocalizationCallback=a,JOB.Config.LocalizationFeedback=!0},SwitchLocalizationFeedback:function(a){JOB.Config.LocalizationFeedback=a},DecodeSingleBarcode:function(){JOB.Config.Multiple=!1},DecodeMultiple:function(){JOB.Config.Multiple=!0},SetDecodeFormats:function(a){JOB.Config.DecodeFormats=[];for(var e=0;e<a.length;e++)-1!=JOB.SupportedFormats.indexOf(a[e])&&JOB.Config.DecodeFormats.push(a[e]);0==JOB.Config.DecodeFormats.length&&(JOB.Config.DecodeFormats=JOB.SupportedFormats.slice())},SkipFormats:function(a){for(var e=0;e<a.length;e++){var t=JOB.Config.DecodeFormats.indexOf(a[e]);t>=0&&JOB.Config.DecodeFormats.splice(t,1)}},AddFormats:function(a){for(var e=0;e<a.length;e++)-1!=JOB.SupportedFormats.indexOf(a[e])&&-1==JOB.Config.DecodeFormats.indexOf(a[e])&&JOB.Config.DecodeFormats.push(a[e])},JOBImageCallback:function(a){if("localization"!=a.data.success)if("orientationData"!=a.data.success){for(var e=[],t=0;t<a.data.result.length;t++)-1!=JOB.Decoded.indexOf(a.data.result[t].Value)&&0!=JOB.Config.ForceUnique||(e.push(a.data.result[t]),JOB.Config.ForceUnique&&JOB.Decoded.push(a.data.result[t].Value));JOB.ImageCallback(e),JOB.Decoded=[]}else JOB.OrientationCallback(a.data.result);else JOB.Config.LocalizationFeedback&&JOB.LocalizationCallback(a.data.result)},JOBStreamCallback:function(a){if("localization"!=a.data.success){if(a.data.success&&JOB.DecodeStreamActive){for(var e=[],t=0;t<a.data.result.length;t++)-1!=JOB.Decoded.indexOf(a.data.result[t].Value)&&0!=JOB.ForceUnique||(e.push(a.data.result[t]),JOB.ForceUnique&&JOB.Decoded.push(a.data.result[t].Value));e.length>0&&JOB.StreamCallback(e)}JOB.DecodeStreamActive&&(JOB.ScanContext.drawImage(JOB.Stream,0,0,JOB.ScanCanvas.width,JOB.ScanCanvas.height),JOB.DecoderWorker.postMessage({scan:JOB.ScanContext.getImageData(0,0,JOB.ScanCanvas.width,JOB.ScanCanvas.height).data,scanWidth:JOB.ScanCanvas.width,scanHeight:JOB.ScanCanvas.height,multiple:JOB.Config.Multiple,decodeFormats:JOB.Config.DecodeFormats,cmd:"normal",rotation:1})),JOB.DecodeStreamActive||(JOB.Decoded=[])}else JOB.Config.LocalizationFeedback&&JOB.LocalizationCallback(a.data.result)},DecodeImage:function(a){var e;a instanceof Image||a instanceof HTMLImageElement?(a.exifdata=!1,a.complete?JOB.Config.SkipOrientation?JOB.JOBDecodeImage(a,1,""):EXIF.getData(a,(function(a){var e=EXIF.getTag(a,"Orientation"),t=EXIF.getTag(a,"SceneCaptureType");"number"!=typeof e&&(e=1),JOB.JOBDecodeImage(a,e,t)})):((e=new Image).onload=function(){JOB.Config.SkipOrientation?JOB.JOBDecodeImage(e,1,""):EXIF.getData(this,(function(a){var e=EXIF.getTag(a,"Orientation"),t=EXIF.getTag(a,"SceneCaptureType");"number"!=typeof e&&(e=1),JOB.JOBDecodeImage(a,e,t)}))},e.src=a.src)):((e=new Image).onload=function(){JOB.Config.SkipOrientation?JOB.JOBDecodeImage(e,1,""):EXIF.getData(this,(function(a){var e=EXIF.getTag(a,"Orientation"),t=EXIF.getTag(a,"SceneCaptureType");"number"!=typeof e&&(e=1),JOB.JOBDecodeImage(a,e,t)}))},e.src=a)},DecodeStream:function(a){JOB.Stream=a,JOB.DecodeStreamActive=!0,JOB.DecoderWorker.onmessage=JOB.JOBStreamCallback,JOB.ScanContext.drawImage(a,0,0,JOB.ScanCanvas.width,JOB.ScanCanvas.height),JOB.DecoderWorker.postMessage({scan:JOB.ScanContext.getImageData(0,0,JOB.ScanCanvas.width,JOB.ScanCanvas.height).data,scanWidth:JOB.ScanCanvas.width,scanHeight:JOB.ScanCanvas.height,multiple:JOB.Config.Multiple,decodeFormats:JOB.Config.DecodeFormats,cmd:"normal",rotation:1})},StopStreamDecode:function(){JOB.DecodeStreamActive=!1,JOB.Decoded=[]},JOBDecodeImage:function(a,e,t){8==e||6==e?"Landscape"==t&&a.width>a.height?(e=1,JOB.ScanCanvas.width=640,JOB.ScanCanvas.height=480):(JOB.ScanCanvas.width=480,JOB.ScanCanvas.height=640):(JOB.ScanCanvas.width=640,JOB.ScanCanvas.height=480),JOB.DecoderWorker.onmessage=JOB.JOBImageCallback,JOB.ScanContext.drawImage(a,0,0,JOB.ScanCanvas.width,JOB.ScanCanvas.height),JOB.Orientation=e,JOB.DecoderWorker.postMessage({scan:JOB.ScanContext.getImageData(0,0,JOB.ScanCanvas.width,JOB.ScanCanvas.height).data,scanWidth:JOB.ScanCanvas.width,scanHeight:JOB.ScanCanvas.height,multiple:JOB.Config.Multiple,decodeFormats:JOB.Config.DecodeFormats,cmd:"normal",rotation:e,postOrientation:JOB.PostOrientation})},DetectVerticalSquash:function(a){var e=a.naturalHeight,t=JOB.SquashCanvas;t.width=1,t.height=e;var n=t.getContext("2d");n.drawImage(a,0,0);try{var o=n.getImageData(0,0,1,e).data}catch(a){return console.log("Cannot check verticalSquash: CORS?"),1}for(var c=0,i=e,r=e;r>c;)0===o[4*(r-1)+3]?i=r:c=r,r=i+c>>1;var d=r/e;return 0===d?1:d},FixCanvas:function(a){var e=a.getContext("2d"),t=e.drawImage;return e.drawImage=function(a,n,o,c,i,r,d,l,O){var s=1;a&&"IMG"==a.nodeName&&(s=JOB.DetectVerticalSquash(a),c||(c=a.naturalWidth),i||(i=a.naturalHeight)),9==arguments.length?t.call(e,a,n,o,c,i,r,d,l,O/s):void 0!==c?t.call(e,a,n,o,c,i/s):t.call(e,a,n,o)},a}};